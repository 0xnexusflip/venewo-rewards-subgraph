# venewo-rewards-subgraph
A Subgraph that logs accounting for:
- Current veNEWO minted by contract
- Current veNEWO user balance for each user
- All time veNEWO burned and minted for each user and the contract
- All time & current NEWO deposits for each user and the contract
- Lock and unlock dates, lock durations, unlock block height and last unlock execution date/block for each user

# Setting up environment
- Run `yarn install` to get all necessary packages
- Run `yarn codegen` to get all necessary autogenerated code before building and deploying
- Run `yarn auth <ACCESS_KEY>` to add the deployment access key to your local environment (Note: To grab access key for Subgraph deployments, go to any Subgraph link in the host accounts' dashboard, copy the `ACCESS KEY` from the page header, then paste it to the command and run it in the CLI)
- To extract a CSV file with user data for a specific network, create a `.env` file following the same template as the `.env.example` file and run `yarn graphclient build` before running the `extract` or the `extract-test-scripts` script
- Note: Only `yarn` is supported out of ease of compatibility (no `npm` `package-lock.json`)

# Execution scripts
- Run `yarn build-<NETWORK_NAME>` to get generated types and build the Subgraph before publishing to The Graph (`mainnet`/`avalanche`)
- Run `yarn deploy-<NETWORK_NAME>` to publish the Subgraph to the Graph Hosted Service for a specific network (`mainnet`/`avalanche`)
- Run `yarn extract <BLOCK_HEIGHT> <BLOCK_TIMESTAMP>` to extract a CSV file with user addresses and respective veNEWO balances and unlock timestamps for users that have an unlock timestamp that hasn't passed yet (in comparison to the `<BLOCK_TIMESTAMP>` provided) in order to be eligible for the airdrop at the given block timestamp. (Note: The CSV file will be created inside the `csv_extractor/outputs` folder with the name `<BLOCK_HEIGHT>_<BLOCK_TIMESTAMP>_<NETWORK>.csv`)
- Run `yarn extract-test-scripts <BLOCK_HEIGHT> <BLOCK_TIMESTAMP>` to extract two CSV files with the total veNEWO balance at the given block height (factory CSV), and the veNEWO balances of each user and the unlock times for each locking user where the unlock time has already passed (in comparison to the `<BLOCK_TIMESTAMP>` provided) at the given block height (users CSV). (Note: The CSV files will be created inside the `query_test_script/test_output` folder with the names `<BLOCK_HEIGHT>_<BLOCK_TIMESTAMP>_<NETWORK>_factory.csv` and `<BLOCK_HEIGHT>_<BLOCK_TIMESTAMP>_<NETWORK>_users.csv`)

# Factory:
- `id`: Contract address
- `allTimeDeposit`: All time amount of NEWO deposits
- `allTimeSharesMinted`: All time amount of veNEWO mints
- `allTimeSharesBurned`: All time amount of veNEWO burns
- `currentDeposit`: Current amount of locked NEWO
- `currentSharesMinted`: Current veNEWO supply

# User:
- `id`: User address
- `allTimeUserDeposit`: All time amount of NEWO deposits
- `allTimeUserSharesMinted`: All time amount of veNEWO mints
- `allTimeUserSharesBurned`: All time amount of veNEWO burns
- `currentUserDeposit`: Current amount of locked NEWO
- `currentUserShares`: Current amount of veNEWO held
- `lockBlock`: Latest block height at which user locked NEWO
- `lockDate`: Latest timestamp at which user locked NEWO
- `lockDuration`: Timeframe from locking to unlocking NEWO
- `unlockDate`: Timestamp at which user can unlock (end of grace period)
